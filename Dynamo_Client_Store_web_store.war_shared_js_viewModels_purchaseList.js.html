<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Dynamo/Client/Store/web/store.war/shared/js/viewModels/purchaseList.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: Dynamo/Client/Store/web/store.war/shared/js/viewModels/purchaseList.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * @fileoverview Defines a PurchaseListViewModel used to represent and maintain the
 * purchase lists.
 *
 */

/*global define */
define(
  //-------------------------------------------------------------------
  // PACKAGE NAME
  //-------------------------------------------------------------------
  'viewModels/purchaseList',

  //-------------------------------------------------------------------
  // DEPENDENCIES
  //-------------------------------------------------------------------
  [
    'knockout',
    'pubsub',
    'CCi18n',
    'jquery',
    'ccConstants',
    'pageLayout/site',
    'ccRestClient',
    'ccStoreConfiguration',
    'viewModels/dynamicPropertyMetaContainer',
    'ccStoreUtils'
  ],

  //-------------------------------------------------------------------
  // MODULE DEFINITION
  //-------------------------------------------------------------------
  function (
    ko,
    pubsub,
    CCi18n,
    $,
    CCConstants,
    SiteViewModel,
    ccRestClient,
    CCStoreConfiguration,
    DynamicPropertyMetaContainer,
    StoreUtils
  ) {

    "use strict";

    //------------------------------------------------------------------
    // Class definition &amp; member variables
    //------------------------------------------------------------------
    /**
     * Creates a purchase list view model. The PurchaseListViewModel is used to hold and manage purchase lists of a customer
     * applicable for a particular account and site.
     * @public
     * @class Purchase list view model.
     * @name PurchaseListViewModel
     */
    function PurchaseListViewModel() {
      var self = this;
      if (PurchaseListViewModel.singleInstance) {
        throw new Error(
          "Cannot instantiate more than one PurchaseListViewModel, use getInstance()");
      }
      self.purchaseListId = null;
      self.purchaseListName = ko.observable();
      self.siteId = ko.observable();
      self.accountId = ko.observable();
      self.selectedPriceListGroup = null;
      self.isB2BUser = ko.observable(false);
      self.lastModifiedDate = ko.observable();
      self.lastModifiedBy = ko.observable();
      self.listOwner = ko.observable();
      self.listOwnerEmail = ko.observable();
      self.listDescription = ko.observable();
      self.items = ko.observableArray([]);
      self.purchaseListDescription = ko.observable();
      self.purchaseListSiteId = ko.observable(null);
      self.purchaseListAccountId = ko.observable(null);
      self.profileId = "";
      self.isPurchaseListShared= ko.observable(false);
      self.storeConfiguration = CCStoreConfiguration.getInstance();
      self.itemsFromFetchPurchaseListCall = ko.observableArray();
      self.skuIds=[];
      self.invalidSkus = [];
      self.organizationSharingEnabled = ko.observable(false);
      self.purchaseListSharingId = ko.observable(null);
      self.defaultEditEnabled = ko.observable(false);
      self.sharedEmailConfigs = ko.observableArray();
      self.hasEditAccess = ko.observable(false);
      self.dynamicPropertyMetaInfo = DynamicPropertyMetaContainer.getInstance();
      self.purchaseListName.extend({required: {params: true, message:CCi18n.t('ns.common:resources.listNameMandatoryText') },
            maxLength: {params: 256, message:CCi18n.t('ns.common:resources.maxAllowedListNameLength') }});
    }
    
      /**
       * Object that holds the purchasrList item
       */
      function PurchaseListItem(item) {
        var self = this;
        self.productName = item.productName;
        self.displayName = item.productName;
        self.productId = item.productId;
        self.catRefId = item.catRefId;
        self.quantityDesired = ko.observable(item.quantityDesired);
        self.selectedOptions = item.selectedOptions;
        self.thumbnailUrl = item.thumbnailUrl;
        self.path =item.path;
        self.isProductDeleted = item.isProductDeleted;
        self.route =item.path;
      }

    /**
     * Return the purchase list Item based on the productId and catRefId passed.
     * @function
     * @name PurchaseListViewModel#getPurchaseListItem
     * @param {string} productId Product ID.
     * @param {string} catRefId Catalog reference ID.
     * @returns {CartItem} Cart item if it exists, otherwise null.
     */
    PurchaseListViewModel.prototype.getPurchaseListItem = function (productId, catRefId) {
      var self = this;
      for (var i = 0; i &lt; self.items().length; i++) {
       //Check matching item in purchaseList using the given productId and catRefId
        if ((self.items()[i].productId === productId) &amp;&amp; (self.items()[i].catRefId === catRefId)) {
          return self.items()[i];
        }
      }
      return null;
    };

    /**
     * function to add objects to items array after fetching the relevant details from search calls 
     * @param data 
     */
    PurchaseListViewModel.prototype.addToPurchaseList = function(data) {
      var self = this;
      if (data &amp;&amp; data.childSKUs) {
        var productFound = false;
        var newQuantity;
        var purchaseListItem = null;
        //Search for corresponding cart item only if line items are to be combined, else proceed just like a new item being added to cart.
        purchaseListItem = self.getPurchaseListItem(data.id, data.childSKUs[0].repositoryId);
        if (purchaseListItem !== null) {
          if(!data.orderQuantity) {
            newQuantity = parseInt(purchaseListItem.quantityDesired()) + (data.quantityDesired||1);
          } else {
            newQuantity = parseInt(purchaseListItem.quantityDesired()) + data.orderQuantity;
          }
          purchaseListItem.quantityDesired(newQuantity);
          productFound = true;
        }
        // If product is not in the purchase list then add it with the quantity set on the new product.
        if (!productFound) {
          if(!data.orderQuantity) {
            newQuantity = data.quantityDesired||1;
          } else {
            newQuantity = data.orderQuantity||1;
          }

          var purchaseListItemData = {
            productName: data.displayName,
            displayName: data.displayName,
            productId: data.id,
            quantityDesired: newQuantity,
            catRefId: data.childSKUs[0].repositoryId, 
            selectedOptions: data.selectedOptions,
            thumbnailUrl: data.primaryThumbImageURL||data.thumbnailUrl,
            path: data.path||data.route,
            route: data.path||data.route
          };
          
          var productItem = new PurchaseListItem(purchaseListItemData);
          productItem.quantityDesired.extend({required: {params: true, message:CCi18n.t('ns.common:resources.emptyCheck') },
          digit: {params: true, message:CCi18n.t('ns.common:resources.validQuantityCheck') },
          min: {params: 1, message:CCi18n.t('ns.common:resources.minQuantityCheck')}});
          self.items.push(productItem);
        }
      }
    };

    /**
     * 'fetchPurchaseList' function.
     * @private
     * @param {purchaseListId} Id of the purchaseList to be fetched 
     * @name fetchPurchaseList
     */
    PurchaseListViewModel.prototype.fetchPurchaseList = function(pPurchaseListId) {
      var self = this;
      var url, status, q="";
      var inputData = {};
      var contextObj = {};
      contextObj[CCConstants.ENDPOINT_KEY] = CCConstants.ENDPOINT_GET_PURCHASE_LIST;
      var filterKey = this.storeConfiguration.getFilterToUse(contextObj);
      if (filterKey) {
        inputData[CCConstants.FILTER_KEY] = filterKey;
      }
      url = CCConstants.ENDPOINT_GET_PURCHASE_LIST;
      ccRestClient.request(url, inputData, self.fetchPurchaseListSuccess.bind(self), self.fetchPurchaseListError.bind(self), pPurchaseListId);  
      url = CCConstants.CHECK_EDIT_ACCESS;
      var data={};
      data["purchaseListId"] = pPurchaseListId;
      ccRestClient.request(url, data, self.hasEditAccessSuccess.bind(self), self.hasEditAccessError.bind(self)); 
    };
    
    /*
     * Function to check if the user has edit access right for a given 
     * purchase list.
     * @param pResult
     */
    PurchaseListViewModel.prototype.hasEditAccessSuccess = function(pResult){
      var self = this;
      self.hasEditAccess(pResult.hasEditAccess);
    };
    
    PurchaseListViewModel.prototype.hasEditAccessError = function(pError){
      
    };
    
    /*
     * Function to fetch purchase list settings of a given purchase list.
     * @param {purchaseListId} Id of the purchase list of which settings are fetched
     * @param {accountId} Account Id of the organization of user trying to fetch settings.
     */
    PurchaseListViewModel.prototype.fetchPurchaseListSettings = function(purchaseListId,accountId, success, error){
       var self = this;
       var inputData = {};
       if(accountId){
         inputData["q"] = "relativeTo eq \"" + purchaseListId + "\" AND account.Id eq \"" + accountId + "\"";
       }else{
         inputData["q"] = "relativeTo eq \"" + purchaseListId + "\"";
       }
       var url = CCConstants.ENDPOINT_GET_PURCHASE_LIST_SETTINGS;
       ccRestClient.request(url, inputData,success? success: self.fetchPurchaseListSettingsSuccess.bind(self),error? error: self.fetchPurchaseListSettingsError.bind(self));      
    };
   
    
    /**
     * success callback for "purchaseListSettings"
     * @param pResult result of fetch purchase list settings
     */
    PurchaseListViewModel.prototype.fetchPurchaseListSettingsSuccess = function(pResult){
      var self = this;
      self.sharedEmailConfigs.removeAll();
      if(pResult){
        if(pResult.items[0] &amp;&amp; pResult.items[0].id){
          self.purchaseListSharingId(pResult.items[0].id);
          self.organizationSharingEnabled(pResult.items[0].organizationSharingEnabled);
          self.defaultEditEnabled(pResult.items[0].defaultEditEnabled);       
          pResult.items[0].sharedEmailConfigs.forEach(function(item){
            self.sharedEmailConfigs.push(item);
          });
        }else{
          self.purchaseListSharingId(null);
          self.organizationSharingEnabled(false);
          self.defaultEditEnabled(false);     
        }     
      }
    };
    
    /**
     * error callback function for 'fetchPurchaseListSettings'
     * @private
     * @param {pError} error while fetchPurchaseListSettings
     * @name fetchPurchaseListSettingsError
     */
    PurchaseListViewModel.prototype.fetchPurchaseListSettingsError = function(pError){
      
    };
    
    /**
     * function to create share settings.
     * @param purchaseListId purchase list id of which settings is to be created.
     * @param accountId accountId of the organization that uses is associated with
     * @comments comment to send to the recipients of the organization
     * @param createPurchaseListSettingsSuccess success callback for create purchase list settings
     * @param createPurchaseListSettingsError   error callback for create purchase list settings
     */    
    PurchaseListViewModel.prototype.createShareSettings = function(purchaseListId, accountId, comments, createPurchaseListSettingsSuccess, createPurchaseListSettingsError){
      var self = this;
      var url = CCConstants.ENDPOINT_CREATE_PURCHASE_LIST_SETTINGS;
      var input={};
      if(accountId == null || accountId == "" || accountId == undefined){
        input["account"] = null;
      }
      else{
        input["account"] ={"id": accountId};
      }
      input["sharedResourceType"]= "purchaseList";
      input["relativeTo"]= purchaseListId;
      input["defaultEditEnabled"]= self.defaultEditEnabled();
      input["organizationSharingEnabled"]= self.organizationSharingEnabled();
      input["comments"]= comments;
      ccRestClient.request(url,input, createPurchaseListSettingsSuccess,createPurchaseListSettingsError);     
    };
    
    /**
     * function to update share settings.
     * @param purchaseListId purchase list id of which settings is to be created.
     * @param accountId accountId of the organization that uses is associated with
     * @comments comment to send to the recipients of the organization
     * @param updateShareSettingsSuccess success callback for update purchase list settings
     * @param createPurchaseListSettingsError   error callback for update purchase list settings
     */  
    PurchaseListViewModel.prototype.updateShareSettings = function(purchaseListId, accountId, comments, updateShareSettingsSuccess, updateShareSettingsError){
      var self = this;
      var url = CCConstants.ENDPOINT_UPDATE_SHARE_SETTINGS;
      var input={};
      var id ={};
      if(accountId == null || accountId == "" || accountId == undefined){
        input["account"] = null;
      }
      else{
        id["id"] = accountId;
          input["account"] =id;
      }
      input["sharedResourceType"]= "purchaseList";
      input["relativeTo"]= purchaseListId;
      input["defaultEditEnabled"]= self.defaultEditEnabled();
      input["organizationSharingEnabled"]= self.organizationSharingEnabled();
      input["comments"]= comments;
      ccRestClient.request(url,input, updateShareSettingsSuccess,updateShareSettingsError, this.purchaseListSharingId());     
    };
      
    /**
     * function to create email configs.
     * @param newEmails Email Ids of new recipients.
     * @comments comment to send to the recipients
     * @param createEmailConfigsSuccess success callback for create email configs
     * @param createEmailConfigsError   error callback for create email configs
     */ 
    PurchaseListViewModel.prototype.createEmailConfigs = function(newEmails, comments, createEmailConfigsSuccess, createEmailConfigsError){
      var self = this;
      var url = CCConstants.ENDPOINT_CREATE_EMAIL_CONFIGS;
      var input={};
      input["emailConfigs"]= newEmails;
      input["comments"]= comments;
      ccRestClient.request(url,input, createEmailConfigsSuccess,createEmailConfigsError, this.purchaseListSharingId());     
    };

    /**
     * function to delete email configs.
     * @param deletedEmails Email Ids of deleted recipients.
     * @param deleteEmailConfigsSuccess success callback for delete email configs
     * @param deleteEmailConfigsError error callback for delete email configs
     */ 
    PurchaseListViewModel.prototype.deleteEmailConfigs = function(deletedEmails, deleteEmailConfigsSuccess, deleteEmailConfigsError){
      var self = this;
      var url = CCConstants.ENDPOINT_DELETE_EMAIL_CONFIGS;
      var input={};
      input["emailConfigs"]= deletedEmails;
      ccRestClient.request(url,input, deleteEmailConfigsSuccess,deleteEmailConfigsError, this.purchaseListSharingId());     
    };
    
    /**
     * function to update email configs.
     * @param deletedEmails Email Ids of updated recipients.
     * @param deleteEmailConfigsSuccess success callback for update email configs
     * @param deleteEmailConfigsError error callback for update email configs
     */ 
    PurchaseListViewModel.prototype.updateEmailConfigs = function(updatedEmails, updateEmailConfigsSuccess, updateEmailConfigsError){
      var self = this;
      var url = CCConstants.ENDPOINT_UPDATE_EMAIL_CONFIGS;
      var input={};
      input["emailConfigs"]= updatedEmails;
      ccRestClient.request(url,input, updateEmailConfigsSuccess,updateEmailConfigsError, this.purchaseListSharingId());     
    };
    
    /**
     * success callback function for 'fetchPurchaseList'
     * @private
     * @param {pResult} result of fetchPurchaseList
     * @name fetchPurchaseListSuccess
     */
    PurchaseListViewModel.prototype.fetchPurchaseListSuccess = function(pResult){
      var self = this;
      if (pResult) {
        var ignoreProperties = self.listOfIgnoreProperties();
        ko.mapping.fromJS(pResult, ignoreProperties, self);
        self.purchaseListName(pResult.name);
        self.lastModifiedDate(pResult.lastModifiedDate);
        if(pResult.lastModifiedBy) {
          self.lastModifiedBy(pResult.lastModifiedBy.firstName +" " + pResult.lastModifiedBy.lastName);
        }
        self.listOwner(pResult.owner.firstName +" "+ pResult.owner.lastName);
        self.listOwnerEmail(pResult.owner.email);
        self.listDescription(pResult.description);
        self.itemsFromFetchPurchaseListCall(pResult.items);
        self.purchaseListDescription(pResult.description);
        self.purchaseListSiteId(pResult.siteId);
        self.purchaseListAccountId(pResult.accountId);
        self.isPurchaseListShared(pResult.sharedWithOthers);
        for(var i=0; i&lt;pResult.items.length; i++) {
          self.skuIds.push(pResult.items[i].catRefId);
        }
        self.fetchSkusDetailsList();
      }
    };
    
    /**
     * error callback function for 'fetchPurchaseList'
     * @private
     * @param {pError} error while fetchPurchaseList
     * @name fetchPurchaseListError
     */
    PurchaseListViewModel.prototype.fetchPurchaseListError = function(pError){
      
    };

    PurchaseListViewModel.prototype.fetchSkusDetailsList = function() {
      var self = this;
      var url = CCConstants.ENDPOINT_PRODUCTS_LIST_SKUS;
      var contextObj = {};
      var inputData ={};
      contextObj[CCConstants.ENDPOINT_KEY] = CCConstants.ENDPOINT_PRODUCTS_LIST_SKUS;
      contextObj[CCConstants.IDENTIFIER_KEY] = "skuListing";
      var filterKey = this.storeConfiguration.getFilterToUse(contextObj);
      if (filterKey) {
        inputData[CCConstants.FILTER_KEY] = filterKey;
      }
      inputData[CCConstants.SKU_IDS]=self.skuIds;
      if(self.skuIds.length>0) {
        var skuData = new Object();
        skuData["deletedSkus"] = [];
        skuData["items"] = [];
        var deferredArray = new Array();
        var batchSize = StoreUtils.getEntityCountLimitInGetRequest(this.storeConfiguration.batchSizeForProdAndSkuData, self.skuIds.length);
        if(batchSize&lt;0) {
          batchSize = self.skuIds.length;
        }
        var individualInputData = Object.create(inputData);
        for (var i=0; i &lt; self.skuIds.length; i) {
          var individualBatchIds = [];
          for (var j=0; j&lt;batchSize &amp;&amp; i&lt;self.skuIds.length; j++,i++) {
            individualBatchIds.push(self.skuIds[i]);
          }
          individualInputData[CCConstants.SKU_IDS] = individualBatchIds;
          deferredArray.push(self.getDataBatch(url, individualInputData));
        }
        $.when.apply(null, deferredArray).done(
            function() {
              for (var i = 0; i&lt; arguments.length; i++) {
                var partialSkuData = arguments[i];
                skuData["deletedSkus"] = partialSkuData["deletedSkus"]!=null ? skuData["deletedSkus"].concat(partialSkuData["deletedSkus"]) : skuData["deletedSkus"];
                skuData["items"] = skuData["items"].concat(partialSkuData["items"]||partialSkuData);
              }
              this.fetchSkuDetailsListSuccess.bind(this, skuData)();
            }.bind(this)
           ).fail(function() {
               var errorData;
               for (var i = 0; i&lt; arguments.length; i++) {
                 errorData = arguments[i];
               }
               this.fetchSkuDetailsListError.bind(this, errorData)();
             }.bind(this));
      } else {
        $.Topic(pubsub.topicNames.PURCHASE_LIST_FETCH_SUCCESS).publish();
      }
    };

    /**
     * Makes a call to the endpoint specified by url, and returns the response data
     * @function ReturnViewModel#getDataBatch
     * @param {String} url URL for the endpoint to hit.
     * @param {String} inputData Data to send in the endpoint request.
     */
    PurchaseListViewModel.prototype.getDataBatch = function(url, inputData) {
      var self = this;
      var deferredObj = $.Deferred();
        ccRestClient.request(url,inputData,
          function(data){
            deferredObj.resolve(data);
          }.bind(this),
          function(data){
            deferredObj.reject(data);
          }.bind(this));
        return deferredObj;
    };

    /**
     * 'fetchSkuDetailsListSuccess' success callback function.
     * @param data result of list skus rest call
     * @name fetchSkuDetailsListSuccess
     */
    PurchaseListViewModel.prototype.fetchSkuDetailsListSuccess = function(data) {
      var self = this;
      var items = data.items || data;
      self.populateAdditionalInfoForItems(items);
      $.Topic(pubsub.topicNames.PURCHASE_LIST_FETCH_SUCCESS).publish();
      self.skuIds = [];
    };

    /**
     * Populates the product details into the purchase list items from
     * listskus endpoint data.
     */
    PurchaseListViewModel.prototype.populateAdditionalInfoForItems = function(items) {
        var self = this;
        var purchaseListItems = [];
        for(var i=0; i&lt;self.itemsFromFetchPurchaseListCall().length; i++) {
        if(self.invalidSkus.indexOf(self.itemsFromFetchPurchaseListCall()[i].catRefId) != -1) {
            var purchaseListItemData = {
                  catRefId:self.itemsFromFetchPurchaseListCall()[i].catRefId,
                  quantityDesired:self.itemsFromFetchPurchaseListCall()[i].quantityDesired,
                  productId: self.itemsFromFetchPurchaseListCall()[i].productId,                  
                  productName:"",
                  displayName:"",
                  thumbnailUrl:null,
                  selectedOptions: null,
                  path: null,
                  route: null,
                  isProductDeleted: true                  
               };

             var productItem = new PurchaseListItem(purchaseListItemData);
             productItem.quantityDesired.extend({required: {params: true, message:CCi18n.t('ns.common:resources.emptyCheck') },
               digit: {params: true, message:CCi18n.t('ns.common:resources.validQuantityCheck') },
               min: {params: 1, message:CCi18n.t('ns.common:resources.minQuantityCheck')}});
             purchaseListItems.push(productItem);
         } else {
              for(var itemIndex=0;itemIndex&lt;items.length;itemIndex++) {
                if(items[itemIndex].repositoryId === self.itemsFromFetchPurchaseListCall()[i].catRefId) {
                  var giftItem = items[itemIndex];
                  var purchaseListItemData = {
                      catRefId:giftItem.repositoryId,
                      quantityDesired:self.itemsFromFetchPurchaseListCall()[i].quantityDesired,
                      productId: giftItem.parentProducts[0].id,
                      productName:giftItem.parentProducts[0].displayName,
                      thumbnailUrl:giftItem.parentProducts[0].thumbImageURLs[0],
                      selectedOptions: giftItem.productVariantOptions ? giftItem.productVariantOptions[0] : null,
                      path: giftItem.parentProducts[0].route,
                      isProductDeleted: false
                    };

                  var productItem = new PurchaseListItem(purchaseListItemData);
                  productItem.quantityDesired.extend({required: {params: true, message:CCi18n.t('ns.common:resources.emptyCheck') },
                    digit: {params: true, message:CCi18n.t('ns.common:resources.validQuantityCheck') },
                    min: {params: 1, message:CCi18n.t('ns.common:resources.minQuantityCheck')}});
                  purchaseListItems.push(productItem);
                }
              }
           }
        }
        self.items(purchaseListItems);
    }

    /**
     * 'fetchSkuDetailsListError' success callback function.
     * @param data result of list skus rest call
     * @name fetchSkuDetailsListError
     */
    PurchaseListViewModel.prototype.fetchSkuDetailsListError = function(data) {
      var self= this;
      if (data.errorCode == CCConstants.GET_SKU_NO_SKU_FOUND &amp;&amp; data.message) {
        //data.message will contain the skuId of the invalid sku.
        var message = data.message;
        if (message.indexOf(":") != -1) {
          var indexOfSkuId = message.indexOf(":") +1;
          var skuId = message.substring(indexOfSkuId).trim();
          self.removeSkuId(skuId);
          self.invalidSkus.push(skuId);
          if(self.skuIds.length == 0) {
            self.populateAdditionalInfoForItems([]);
            $.Topic(pubsub.topicNames.PURCHASE_LIST_FETCH_SUCCESS).publish();
          } else {
            self.fetchSkusDetailsList();
          }
        }
      }
    };

    /**
     * Remove items from the cart matching the given product ID.
     *
     * @function
     * @name CartViewModel#removeItemsByProduct
     * @param {string} productId Product ID which will be removed from cart.
     * @returns {boolean} true if any items were removed from the cart, otherwise false.
     */
    PurchaseListViewModel.prototype.removeSkuId = function (skuId) {
      var self = this;
      var newSkuIds = [];
      for (var i = 0; i &lt; self.skuIds.length; i++) {
        if (self.skuIds[i] != skuId) {
          newSkuIds.push(self.skuIds[i]);
        }
      }
      self.skuIds = newSkuIds;
    };

    /**
     * function to filter properties in purchase list items for server call.
     * @param pItems - purchase list items that holds all the information 
     *                 required in UI.
     */
    PurchaseListViewModel.prototype.createInputPurchaseListItems = function(pItems) {
      var inputPurchaseListItems = [];
      pItems.forEach(function(item){
        var inputItem = {};
        inputItem.productId = item.productId;
        inputItem.catRefId = item.catRefId;
        inputItem.quantityDesired = Number(item.quantityDesired());
        inputPurchaseListItems.push(inputItem);
      });
      return inputPurchaseListItems;
    };

    /**
     * function to create new purchase list.
     * @param createPurchaseListSuccess success callback for create purchase list
     * @param createPurchaseListError   error callback for create purchase list
     */
    PurchaseListViewModel.prototype.createNewPurchaseList = function(createPurchaseListSuccess, createPurchaseListError) {
      var self = this;
      var items = self.createInputPurchaseListItems(self.items());
      var data = {"name": self.purchaseListName(),
                  "items": items}
      if(self.purchaseListSiteId()) {
        data["siteId"] = self.purchaseListSiteId();
      }
      if(self.purchaseListAccountId()) {
        data["accountId"] = self.purchaseListAccountId();
      }
      ccRestClient.request(CCConstants.ENDPOINT_CREATE_PURCHASE_LIST,data, 
      createPurchaseListSuccess,createPurchaseListError);
    };
      
    /**
     * function to update a purchase list.
     * @param pPurchaseListId id of the purchase list to be updated
     * @param updatePurchaseListSuccess success callback for update purchase list
     * @param updatePurchaseListError   error callback for update purchase list
     */
    PurchaseListViewModel.prototype.updatePurchaseList = function(
        pPurchaseListId, updatePurchaseListSuccess, updatePurchaseListError) {
      var self = this;
      var items = self.createInputPurchaseListItems(self.items());
      var data = {"name": self.purchaseListName(),
                  "items": items,
                  "siteId": self.purchaseListSiteId(),
                  "accountId": self.purchaseListAccountId(),
                  "description":self.listDescription()};
      ccRestClient.request(CCConstants.ENDPOINT_UPDATE_PURCHASE_LIST,data, 
      updatePurchaseListSuccess,updatePurchaseListError, pPurchaseListId);
    };

    /**
     * function to delete a purchase list.
     * @param purchaseListId id of the purchase list to be deleted
     * @param deletePurchaseListSuccess success callback for delete purchase list
     * @param deletePurchaseListError   error callback for delete purchase list
     */
    PurchaseListViewModel.prototype.deletePurchaseList= function(purchaseListId,deletePurchaseListSuccess,
        deletePurchaseListError) {
      var self=this;
      var url,status,q="", inputData;
      inputData = {};
      var contextObj = {};
      contextObj[CCConstants.ENDPOINT_KEY] = CCConstants.ENDPOINT_DELETE_PURCHASE_LIST;
      url = CCConstants.ENDPOINT_DELETE_PURCHASE_LIST;
      ccRestClient.request(url,inputData,
      deletePurchaseListSuccess,deletePurchaseListError,purchaseListId);
    };

    /**
     * Resets the current purchase list information
     * @name reset
     */
     PurchaseListViewModel.prototype.reset = function(){
       var self=this;
       self.purchaseListId = null;
       self.purchaseListName('');
       self.lastModifiedDate();
       self.lastModifiedBy('');
       self.listOwner('');
       self.listOwnerEmail('');
       self.isPurchaseListShared(false);
       self.listDescription('');
       self.items.removeAll();
       self.skuIds = [];
    };
    
    /**
     * This method populates purchase list dynamic property meta data into
     * dynamic property meta container view model.
     *
     * @private
     * @function
     * @name PurchaseListViewModel#populateDynamicPropertyMetaData
     */
    PurchaseListViewModel.prototype.populateDynamicPropertiesMetaData = function() {
      var self = this;
      var pramas = {};
      pramas[CCConstants.PARENT] = CCConstants.ENDPOINT_PURCHASE_LIST_TYPE;
      if (self.dynamicPropertyMetaInfo &amp;&amp; self.dynamicPropertyMetaInfo.dynamicPropertyMetaCache &amp;&amp; 
          !self.dynamicPropertyMetaInfo.dynamicPropertyMetaCache.hasOwnProperty(CCConstants.ENDPOINT_PURCHASE_LIST_TYPE)) {

        ccRestClient.request(CCConstants.ENDPOINT_GET_ITEM_TYPE, pramas,
          //success callback
          function(dynamicPropData){
            self.dynamicPropertyMetaInfo.intializeDynamicProperties(dynamicPropData.specifications, CCConstants.ENDPOINT_PURCHASE_LIST_TYPE);
          },
          //error callback
          function(dynamicPropData) {
          
          },
          CCConstants.ENDPOINT_PURCHASE_LIST_TYPE);
      }
    };
    
    /**
     * Returns list of purchase list properties that should be ignored during 
     * fromJS call.
     * @private
     * @function
     * @name PurchaseListViewModel#listOfIgnoreProperties
     */
    PurchaseListViewModel.prototype.listOfIgnoreProperties = function() {
      var ignoreProperties = {
        'ignore': ["name", "lastModifiedDate","lastModifiedBy","listOwner","listOwnerEmail","listDescription", "items", "description", "siteId",
                   "accountId"]
      }
      return ignoreProperties;
    }

    /**
     * Returns a singleton instance of the PurchaseListViewModel
     */
    PurchaseListViewModel.getInstance = function() {
      if (!PurchaseListViewModel.singleInstance) {
        PurchaseListViewModel.singleInstance = new PurchaseListViewModel();
      }
      return PurchaseListViewModel.singleInstance;
    };

   /**
    * Add items to an existing purchase list.
    * @name addItemToPurchaseList
    */
    PurchaseListViewModel.prototype.addItemToPurchaseList = function(purchaseList,itemsArray, addItemToPurchaseListSuccess, addItemToPurchaseListError){
      var requestJson = {
        "items": itemsArray,
      };

      ccRestClient.request(CCConstants.ENDPOINT_ADD_ITEM_PURCHASE_LIST,
                           requestJson,
                           addItemToPurchaseListSuccess.bind(this,itemsArray,purchaseList),
                           addItemToPurchaseListError,
                           purchaseList.purchaseListId);
    };
    
    return PurchaseListViewModel;
  });
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-ccKoErrorWrapper.html">ccKoErrorWrapper</a></li><li><a href="module-ccKoExtensions.html">ccKoExtensions</a></li></ul><h3>Classes</h3><ul><li><a href="Address.html">Address</a></li><li><a href="CartViewModel.html">CartViewModel</a></li><li><a href="CCStoreConfiguration.html">CCStoreConfiguration</a></li><li><a href="CheckoutScheduledOrder.html">CheckoutScheduledOrder</a></li><li><a href="delegatedAdminContacts.html">delegatedAdminContacts</a></li><li><a href="DynamicProperty.html">DynamicProperty</a></li><li><a href="DynamicPropertyMetaContainer.html">DynamicPropertyMetaContainer</a></li><li><a href="EventDispatcher.html">EventDispatcher</a></li><li><a href="GiftCardViewModel.html">GiftCardViewModel</a></li><li><a href="GiftProductListingViewModel.html">GiftProductListingViewModel</a></li><li><a href="global.html#InfinityViewModel">InfinityViewModel</a></li><li><a href="IntegrationViewModel.html">IntegrationViewModel</a></li><li><a href="ko.bindingHandlers.background.html">background</a></li><li><a href="ko.bindingHandlers.carouselSwipe.html">carouselSwipe</a></li><li><a href="ko.bindingHandlers.ccDateTime.html">ccDateTime</a></li><li><a href="ko.bindingHandlers.ccForm.html">ccForm</a></li><li><a href="ko.bindingHandlers.ccLink.html">ccLink</a></li><li><a href="ko.bindingHandlers.ccValidation.html">ccValidation</a></li><li><a href="ko.bindingHandlers.checkbox.html">checkbox</a></li><li><a href="ko.bindingHandlers.chosen.html">chosen</a></li><li><a href="ko.bindingHandlers.contextResourcesNamespace.html">contextResourcesNamespace</a></li><li><a href="ko.bindingHandlers.currency.html">currency</a></li><li><a href="ko.bindingHandlers.datepicker.html">datepicker</a></li><li><a href="ko.bindingHandlers.datepopover.html">datepopover</a></li><li><a href="ko.bindingHandlers.draggable.html">draggable</a></li><li><a href="ko.bindingHandlers.droppable.html">droppable</a></li><li><a href="ko.bindingHandlers.fade.html">fade</a></li><li><a href="ko.bindingHandlers.hover.html">hover</a></li><li><a href="ko.bindingHandlers.image.html">image</a></li><li><a href="ko.bindingHandlers.imageSource.html">imageSource</a></li><li><a href="ko.bindingHandlers.imageZoom.html">imageZoom</a></li><li><a href="ko.bindingHandlers.localeText.html">localeText</a></li><li><a href="ko.bindingHandlers.makeAccess.html">makeAccess</a></li><li><a href="ko.bindingHandlers.modal.html">modal</a></li><li><a href="ko.bindingHandlers.modalTabbingContraint.html">modalTabbingContraint</a></li><li><a href="ko.bindingHandlers.onRender.html">onRender</a></li><li><a href="ko.bindingHandlers.popeditor.html">popeditor</a></li><li><a href="ko.bindingHandlers.popover.html">popover</a></li><li><a href="ko.bindingHandlers.productImageSource.html">productImageSource</a></li><li><a href="ko.bindingHandlers.productVariantImageSource.html">productVariantImageSource</a></li><li><a href="ko.bindingHandlers.propertyEditor.html">propertyEditor</a></li><li><a href="ko.bindingHandlers.radio.html">radio</a></li><li><a href="ko.bindingHandlers.richTextEditor.html">richTextEditor</a></li><li><a href="ko.bindingHandlers.scrollAffix.html">scrollAffix</a></li><li><a href="ko.bindingHandlers.select2.html">select2</a></li><li><a href="ko.bindingHandlers.select2Tags.html">select2Tags</a></li><li><a href="ko.bindingHandlers.selectable.html">selectable</a></li><li><a href="ko.bindingHandlers.slide.html">slide</a></li><li><a href="ko.bindingHandlers.slider.html">slider</a></li><li><a href="ko.bindingHandlers.spectrum.html">spectrum</a></li><li><a href="ko.bindingHandlers.textCheck.html">textCheck</a></li><li><a href="ko.bindingHandlers.timepicker.html">timepicker</a></li><li><a href="ko.bindingHandlers.triggerMessage.html">triggerMessage</a></li><li><a href="ko.bindingHandlers.validatableTarget.html">validatableTarget</a></li><li><a href="ko.bindingHandlers.validatableValue.html">validatableValue</a></li><li><a href="ko.bindingHandlers.widgetLocaleText.html">widgetLocaleText</a></li><li><a href="koValidation.alphaNumeric.html">alphaNumeric</a></li><li><a href="koValidation.alphaNumericNoSpaces.html">alphaNumericNoSpaces</a></li><li><a href="koValidation.alphaNumericNoSpacesNoDashesWithSeperators.html">alphaNumericNoSpacesNoDashesWithSeperators</a></li><li><a href="koValidation.alphaNumericNoSpacesWithSeperators.html">alphaNumericNoSpacesWithSeperators</a></li><li><a href="koValidation.alphaNumericWithSeperators.html">alphaNumericWithSeperators</a></li><li><a href="koValidation.bool.html">bool</a></li><li><a href="koValidation.creditcard.html">creditcard</a></li><li><a href="koValidation.cvv.html">cvv</a></li><li><a href="koValidation.endmonth.html">endmonth</a></li><li><a href="koValidation.endyear.html">endyear</a></li><li><a href="koValidation.importFileName.html">importFileName</a></li><li><a href="koValidation.laterDate.html">laterDate</a></li><li><a href="koValidation.match.html">match</a></li><li><a href="koValidation.mediaZipFileName.html">mediaZipFileName</a></li><li><a href="koValidation.number.html">number</a></li><li><a href="koValidation.observablePattern.html">observablePattern</a></li><li><a href="koValidation.password.html">password</a></li><li><a href="koValidation.price.html">price</a></li><li><a href="koValidation.propertyIdAlreadyInUse.html">propertyIdAlreadyInUse</a></li><li><a href="koValidation.propertyNameAlreadyInUse.html">propertyNameAlreadyInUse</a></li><li><a href="koValidation.restrictSlashCharacters.html">restrictSlashCharacters</a></li><li><a href="koValidation.startmonth.html">startmonth</a></li><li><a href="koValidation.startyear.html">startyear</a></li><li><a href="koValidation.uniqueTrimmed.html">uniqueTrimmed</a></li><li><a href="koValidation.uniqueTrimmedCaseInsensitive.html">uniqueTrimmedCaseInsensitive</a></li><li><a href="koValidation.url.html">url</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.addTemplate.html">addTemplate</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.agentBar.html">agentBar</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.ccDate.html">ccDate</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.ccNumber.html">ccNumber</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.ccResizeImage.html">ccResizeImage</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.disabled.html">disabled</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.element.html">element</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.embeddedAssistance.html">embeddedAssistance</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.fireChange.html">fireChange</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.inTabFlow.html">inTabFlow</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.noIndexMeta.html">noIndexMeta</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.previewBar.html">previewBar</a></li><li><a href="module-ccKoExtensions-ko.bindingHandlers.setContextVariable.html">setContextVariable</a></li><li><a href="multiCartViewModel.html">multiCartViewModel</a></li><li><a href="NavStateViewModel.html">NavStateViewModel</a></li><li><a href="OrderDetailsViewModel.html">OrderDetailsViewModel</a></li><li><a href="OrderHistoryViewModel.html">OrderHistoryViewModel</a></li><li><a href="OrdersPendingApprovalViewModel.html">OrdersPendingApprovalViewModel</a></li><li><a href="OrderViewModel.html">OrderViewModel</a></li><li><a href="Organization.html">Organization</a></li><li><a href="ParentOrganisation.html">ParentOrganisation</a></li><li><a href="ProductListingSearchViewModel.html">ProductListingSearchViewModel</a></li><li><a href="ProductListingViewModel.html">ProductListingViewModel</a></li><li><a href="ProductTypes.html">ProductTypes</a></li><li><a href="ProductViewModel.html">ProductViewModel</a></li><li><a href="PromotionUpsellContainer.html">PromotionUpsellContainer</a></li><li><a href="PubSub.topicNames.html">topicNames</a></li><li><a href="PurchaseListListingViewModel.html">PurchaseListListingViewModel</a></li><li><a href="PurchaseListViewModel.html">PurchaseListViewModel</a></li><li><a href="RegistrationRequestSearchViewModel.html">RegistrationRequestSearchViewModel</a></li><li><a href="resetCVV.html">resetCVV</a></li><li><a href="resetGiftCardPin.html">resetGiftCardPin</a></li><li><a href="resetPaymentDetails.html">resetPaymentDetails</a></li><li><a href="ReturnItem.html">ReturnItem</a></li><li><a href="ReturnViewModel.html">ReturnViewModel</a></li><li><a href="scheduledOrderList.html">scheduledOrderList</a></li><li><a href="SearchRestClient.html">SearchRestClient</a></li><li><a href="ServerData.html">ServerData</a></li><li><a href="UserViewModel.html">UserViewModel</a></li><li><a href="WidgetViewModel.html">WidgetViewModel</a></li><li><a href="WishlistContentViewModel.html">WishlistContentViewModel</a></li></ul><h3>Namespaces</h3><ul><li><a href="ko.bindingHandlers.html">bindingHandlers</a></li><li><a href="ko.extenders.html">extenders</a></li><li><a href="koValidation.html">koValidation</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addItemToPurchaseList">addItemToPurchaseList</a></li><li><a href="global.html#callWidgetMethodIfApplicable">callWidgetMethodIfApplicable</a></li><li><a href="global.html#CartViewModel#deleteParticularIncompleteOrdersDeletesanincompleteorderbyorderId">CartViewModel#deleteParticularIncompleteOrdersDeletes an incomplete order by orderId</a></li><li><a href="global.html#CCEETagProcessor">CCEETagProcessor</a></li><li><a href="global.html#doesSiteExist">doesSiteExist</a></li><li><a href="global.html#fetchSkuDetailsListError">fetchSkuDetailsListError</a></li><li><a href="global.html#fetchSkuDetailsListSuccess">fetchSkuDetailsListSuccess</a></li><li><a href="global.html#formatSiteText">formatSiteText</a></li><li><a href="global.html#handleInitiateEditSuccess">handleInitiateEditSuccess</a></li><li><a href="global.html#isModified">isModified</a></li><li><a href="global.html#isValidDeterminewhetherornotthepaymentdetailsobjectisvalidbasedonthevalidityofitscomponentparts.Thiswillnotcauseerrormessagestobedisplayedforanyobservablevaluesthatareunchangedandhaveneverreceivedfocusontherelatedformfield(s).">isValidDetermine whether or not the payment details object is validbased on the validity of its component parts. This will notcause error messages to be displayed for any observable valuesthat are unchanged and have never received focus on the related form field(s).</a></li><li><a href="global.html#justFocused">justFocused</a></li><li><a href="global.html#mapProperties">mapProperties</a></li><li><a href="global.html#MENU_CLOSE_TIMEOUT">MENU_CLOSE_TIMEOUT</a></li><li><a href="global.html#populateData">populateData</a></li><li><a href="global.html#populateProductData">populateProductData</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#resetModified">resetModified</a></li><li><a href="global.html#Resetsstylingforthelazilyloadedimage">Resets styling for the lazily loaded image</a></li><li><a href="global.html#Setsupstylingfortheimagetobelazilyloaded">Sets up styling for the image to be lazily loaded</a></li><li><a href="global.html#ShopperContextViewModel">ShopperContextViewModel</a></li><li><a href="global.html#thelistofpropertiestoignorewhilecopyingdynamicpropertiestoaddressobject">the list of properties to ignore while copying dynamic properties to address object</a></li><li><a href="global.html#validatePaymentDetailsForceallrelevantmemberobservablestoperformtheirvalidationnow&displaytheerrors(ifany)">validatePaymentDetailsForce all relevant member observables to perform theirvalidation now & display the errors (if any)</a></li><li><a href="global.html#WidgetQueue">WidgetQueue</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0</a> on Wed Feb 26 2020 18:22:22 GMT+0530 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
